<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ‚</text></svg>">

    <!-- âœ… Firebase SDKs (Compat version) -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            color: #f3f4f6;
            overflow: hidden;
            margin: 0;
            padding: 0;
            position: relative; 
            height: 100vh;
            width: 100vw;
        }
        
        .page {
            position: fixed; top: 0; left: 0;
            width: 100vw; height: 100vh;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            background-color: #000;
        }

        /* --- Auth Page Styles --- */
        #authPage { z-index: 9999; background: #000; }
        #authPage h1 { font-size: 2rem; margin-bottom: 1rem; }

        #googleLoginBtn {
            background: white;
            color: #000;
            font-weight: bold;
            padding: 12px 24px;
            border-radius: 8px;
            display: flex; align-items: center; gap: 8px;
            box-shadow: 0 4px 10px rgba(255,255,255,0.2);
            transition: all 0.2s;
            cursor: pointer;
        }
        #googleLoginBtn:hover { transform: scale(1.05); background: #f1f1f1; }
        #googleLoginBtn:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }

        #status {
            margin-top: 15px;
            color: #f87171;
            font-weight: 500;
            text-align: center;
            max-width: 90%;
            background: rgba(255, 0, 0, 0.1);
            padding: 10px;
            border-radius: 8px;
            display: none; /* Hidden by default */
        }

        /* --- Main App Styles --- */
        #sourceCanvas { display: none; }
        
        #canvasWrapper {
            width: 100vw; height: 100vh;
            display: flex; align-items: center; justify-content: center;
            position: fixed; top: 0; left: 0;
        }

        #pixelCanvas {
            width: 1024px; height: 1024px;
            max-width: 100vw; max-height: 100vh;
            background-color: #000;
            image-rendering: pixelated; 
            image-rendering: crisp-edges;
            z-index: 0; 
        }

        #canvasPlaceholder { position: absolute; z-index: 1; }

        /* Animations */
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            60% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .pop-in { animation: popIn 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .fade-out { animation: fadeOut 0.5s ease-out forwards; }

        /* --- Gallery Styles --- */
        #galleryScroller {
            display: flex; gap: 24px; padding: 24px;
            width: 100%; overflow-x: auto; white-space: nowrap;
            perspective: 1000px;
        }

        .gallery-card {
            flex-shrink: 0; width: 300px; height: 400px;
            background-color: #222; border-radius: 16px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
            overflow: hidden;
            transition: transform 0.4s ease, box-shadow 0.4s ease;
            transform: rotateY(15deg);
        }
        .gallery-card:hover { transform: rotateY(0deg) scale(1.05); box-shadow: 0 15px 30px rgba(0,0,0,0.6); z-index: 10; }
        .gallery-card img, .gallery-card video { width: 100%; height: 100%; object-fit: cover; }
        .gallery-card img::before { content: "Image loading..."; display: block; text-align: center; padding-top: 180px; color: #888; }

        /* --- Birthday Text --- */
        #birthdayTextOverlay {
            position: absolute; bottom: 8%; left: 0; width: 100%;
            z-index: 100; text-align: center;
            display: flex; justify-content: center; flex-wrap: wrap; pointer-events: none; 
        }
        .letter-span {
            display: inline-block; opacity: 0; transform: translateY(40px); margin-right: 0.05em;
            text-shadow: 0 4px 15px rgba(0,0,0,0.8); 
        }
        .space-span { display: inline-block; width: 0.6em; }
        .animate-letter { animation: letterFadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        @keyframes letterFadeInUp {
            0% { opacity: 0; transform: translateY(40px) scale(0.8); text-shadow: 0 0 0 rgba(255,255,255,0); }
            100% { opacity: 1; transform: translateY(0) scale(1); text-shadow: 0 0 30px rgba(255,255,255,1); }
        }
        .hidden-overlay { display: none !important; }
    </style>
</head>
<body>

    <!-- ðŸ” LOGIN PAGE -->
    <div id="authPage" class="page">
        <!-- YOUR CUSTOM TEXT -->
        <h1 class="text-white font-bold mb-6">ðŸŽ‰ Welcome!</h1>
        <button id="googleLoginBtn">
            <img src="https://www.svgrepo.com/show/475656/google-color.svg" width="24" height="24" alt="Google">
            Sign in with Google
        </button>
        <p id="status"></p>
    </div>

    <!-- ðŸŽ‚ MAIN CONTENT -->
    <div id="mainContent" class="hidden">
        <!-- Page 1 -->
        <div id="page1_start" class="page z-50 pop-in">
            <button id="startButton" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-8 rounded-full shadow-lg transform hover:scale-105 transition-transform duration-200 text-2xl">Start</button>
        </div>
        <!-- Page 2 -->
        <div id="page2_birthday" class="page z-40 hidden">
            <!-- YOUR CUSTOM TEXT -->
            <h1 class="text-6xl font-bold text-white mb-8 text-center animate-pulse">Happy Birthday MJ Mishra Janhvee!</h1>
            <button id="birthdayContinueButton" class="bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-4 px-8 rounded-full shadow-lg transform hover:scale-105 transition-transform duration-200 text-2xl">Continue</button>
        </div>
        <!-- Page 3 -->
        <div id="page3_gallery" class="page z-30 hidden">
            <h2 class="text-4xl font-bold text-white mb-4 text-center px-4">A Few Happy Memories...</h2>
            <div id="galleryScroller">
                 <div class="gallery-card"><img src="./IMG-20250915-WA0055.jpg" alt="Memory 0" onerror="this.src='https://placehold.co/300x400/222/FFF?text=IMG-20250915-WA0055.jpg'"></div>
                <div class="gallery-card"><img src="./IMG-20250915-WA0056.jpg" alt="Memory 1" onerror="this.src='https://placehold.co/300x400/222/FFF?text=IMG-20250915-WA0056.jpg'"></div>
                <div class="gallery-card"><video src="./VID-20250915-WA0030.mp4" controls preload="metadata"></video></div>
                <div class="gallery-card"><img src="./IMG-20250915-WA0067.jpg" alt="Memory 2" onerror="this.src='https://placehold.co/300x400/222/FFF?text=IMG-20250915-WA0067.jpg'"></div>
                <div class="gallery-card"><img src="./IMG-20250915-WA0068~2.jpg" alt="Memory 3" onerror="this.src='https://placehold.co/300x400/222/FFF?text=IMG-20250915-WA0068~2.jpg'"></div>
                <div class="gallery-card"><img src="./IMG-20250919-WA0238.jpg" alt="Memory 4" onerror="this.src='https://placehold.co/300x400/222/FFF?text=IMG-20250919-WA0238.jpg'"></div>
                <div class="gallery-card"><img src="./Snapchat-2031502399.jpg" alt="Memory 5" onerror="this.src='https://placehold.co/300x400/222/FFF?text=Snapchat-2031502399.jpg'"></div>
                <div class="gallery-card"><img src="./IMG_20250727_212036_193.webp" alt="Memory 6" onerror="this.src='https://placehold.co/300x400/222/FFF?text=IMG_20250727_212036_193.webp'"></div>
                <div class="gallery-card"><img src="./IMG_20250822_144858361~2.jpg" alt="Memory 7" onerror="this.src='https://placehold.co/300x400/222/FFF?text=IMG_20250822_144858361~2.jpg'"></div>
                <div class="gallery-card"><img src="./IMG_20250919_135356382_HDR_PORTRAIT (1).jpg" alt="Memory 8" onerror="this.src='https://placehold.co/300x400/222/FFF?text=IMG_20250919...jpg'"></div>
                <div class="gallery-card"><img src="./Screenshot_20250831-180221.Moto App Launcher.jpg" alt="Memory 9" onerror="this.src='https://placehold.co/300x400/222/FFF?text=Screenshot_20250831...jpg'"></div>
                <div class="gallery-card"><img src="./Screenshot_20251110-225727.Moto App Launcher.png" alt="Memory 10" onerror="this.src='httpsG-placehold.co/300x400/222/FFF?text=Screenshot_20251110...png'"></div>
                <div class="gallery-card"><img src="./Screenshot_20251110-225746.Moto App Launcher.png" alt="Memory 11" onerror="this.src='httpsG-placehold.co/300x400/222/FFF?text=Screenshot_20251110...png'"></div>
                <div class="gallery-card"><img src="./Screenshot_20251110-225806.Moto App Launcher.png" alt="Memory 12" onerror="this.src='httpsS-placehold.co/300x400/222/FFF?text=Screenshot_20251110...png'"></div>
                <div class="gallery-card"><img src="./Screenshot_20251110-225825.Moto App Launcher.png" alt="Memory 13" onerror="this.src='httpsG-placehold.co/300x400/222/FFF?text=Screenshot_20251110...png'"></div>
            </div>
            <div class="text-white text-xl mt-8 text-center">
                <div id="ageTimer" class="font-mono text-3xl mb-2"></div>
                Enjoy your early twenties!
            </div>
            <button id="galleryContinueButton" class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-full shadow-lg transform hover:scale-105 transition-transform duration-200 text-2xl mt-8">View Your Gift</button>
        </div>
        <!-- Page 4 -->
        <div id="page4_animation" class="hidden">
            <div id="canvasWrapper">
                <p id="canvasPlaceholder" class="text-gray-500 text-xl">Loading...</p>
                <canvas id="pixelCanvas"></canvas>
                <div id="birthdayTextOverlay" class="text-white text-6xl font-extrabold hidden-overlay"></div>
            </div>
            <canvas id="sourceCanvas"></canvas>
            <audio id="birthdayAudio" src="./music.mp3" preload="auto" loop></audio>
        </div>
    </div>

    <script>
        // DOM Elements
        const authPage = document.getElementById('authPage');
        const mainContent = document.getElementById('mainContent');
        const googleLoginBtn = document.getElementById('googleLoginBtn');
        const status = document.getElementById('status');
        
        // --- ðŸ”¥ DEBUGGING & PROTOCOL CHECK ---
        function showStatus(msg) {
            status.style.display = 'block';
            status.textContent = msg;
        }

        if (window.location.protocol === 'file:') {
            showStatus("âš ï¸ CRITICAL: You are running this file locally (file://). Google Login WILL NOT WORK. You must host this on GitHub Pages or use a local server (like VS Code Live Server).");
            googleLoginBtn.disabled = true;
        }

        // --- ðŸ”¥ FIREBASE INIT WITH ERROR CHECK ---
        let auth;
        try {
            if (typeof firebase === 'undefined') {
                throw new Error("Firebase SDK not loaded. Check internet connection.");
            }

            const firebaseConfig = {
              apiKey: "AIzaSyDPH2vLorHnbgXsVBLZz5ZVqeEL49tmeFM",
              authDomain: "course-app-a1d28.firebaseapp.com",
              databaseURL: "https://course-app-a1d28-default-rtdb.firebaseio.com",
              projectId: "course-app-a1d28",
              storageBucket: "course-app-a1d28.firebasestorage.app",
              messagingSenderId: "626435621011",
              appId: "1:626435621011:web:86fe095d0d36de609a4d66",
              measurementId: "G-8C9MPXVSZH"
            };
            
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            console.log("Firebase Initialized Successfully");

        } catch (e) {
            console.error(e);
            showStatus("âŒ Initialization Error: " + e.message);
            googleLoginBtn.disabled = true;
        }

        const allowedEmails = ["janhveemishra4@gmail.com", "vbhrshrvstv@gmail.com"];

        // ðŸŸ¢ GOOGLE LOGIN HANDLER (WITH DEBUGGING)
        if (googleLoginBtn && !googleLoginBtn.disabled) {
            googleLoginBtn.addEventListener('click', async () => {
                console.log("Button clicked...");
                // Visual Feedback
                googleLoginBtn.textContent = "Wait...";
                googleLoginBtn.disabled = true;
                status.style.display = 'none';

                const provider = new firebase.auth.GoogleAuthProvider();
                try {
                    const result = await auth.signInWithPopup(provider);
                    const user = result.user;
                    console.log("Logged in as:", user.email);

                    if (allowedEmails.includes(user.email)) {
                        authPage.style.display = "none";
                        mainContent.classList.remove('hidden');
                    } else {
                        showStatus("â›” Access denied: Email not in list.");
                        await auth.signOut();
                        googleLoginBtn.textContent = "Sign in with Google";
                        googleLoginBtn.disabled = false;
                    }
                } catch (error) {
                    console.error("Login failed:", error);
                    
                    // Specific Error Handling
                    let errorMsg = `âŒ Login failed: ${error.message}`;
                    if (error.code === 'auth/unauthorized-domain') {
                        errorMsg = `âŒ DOMAIN ERROR: Go to Firebase Console -> Auth -> Settings -> Authorized Domains. Add: '${window.location.hostname}'`;
                    } else if (error.code === 'auth/operation-not-allowed') {
                        errorMsg = "âŒ CONFIG ERROR: Enable 'Google' provider in Firebase Console.";
                    } else if (error.code === 'auth/popup-closed-by-user') {
                        errorMsg = "âš ï¸ Login cancelled by user.";
                    }

                    showStatus(errorMsg);
                    googleLoginBtn.textContent = "Sign in with Google";
                    googleLoginBtn.disabled = false;
                }
            });
        }

        // ðŸ” AUTH STATE LISTENER
        if (auth) {
            auth.onAuthStateChanged((user) => {
                if (user && allowedEmails.includes(user.email)) {
                    authPage.style.display = "none";
                    mainContent.classList.remove('hidden');
                } else {
                    mainContent.classList.add('hidden');
                    authPage.style.display = "flex";
                }
            });
        }

        /* ----------------------------
           ðŸŽ¨ ANIMATION LOGIC (UNCHANGED)
        ---------------------------- */
        const page1_start = document.getElementById('page1_start');
        const page2_birthday = document.getElementById('page2_birthday');
        const page3_gallery = document.getElementById('page3_gallery');
        const page4_animation = document.getElementById('page4_animation');
        const startButton = document.getElementById('startButton');
        const birthdayContinueButton = document.getElementById('birthdayContinueButton');
        const galleryContinueButton = document.getElementById('galleryContinueButton');
        const ageTimer = document.getElementById('ageTimer');
        const birthdayTextOverlay = document.getElementById('birthdayTextOverlay');
        const sourceCanvas = document.getElementById('sourceCanvas');
        const sourceCtx = sourceCanvas.getContext('2d');
        const pixelCanvas = document.getElementById('pixelCanvas');
        const pixelCtx = pixelCanvas.getContext('2d');
        const canvasPlaceholder = document.getElementById('canvasPlaceholder');
        const birthdayAudio = document.getElementById('birthdayAudio');

        let originalImage = null;
        let flyingPixels = [];
        let animationId = null;
        const EASING_FACTOR = 0.25; 
        const birthDate = new Date('2005-11-12T01:00:00'); 

        function updateAge() {
            // âœ… FIXED: Now uses the ACTUAL current time from your system
            const now = new Date(); 
            const diffMs = now.getTime() - birthDate.getTime();

            if (diffMs < 0) { ageTimer.textContent = "Loading age..."; return; }
            let absDiffMs = diffMs;
            const years = Math.floor(absDiffMs / (1000 * 60 * 60 * 24 * 365.25));
            absDiffMs -= years * (1000 * 60 * 60 * 24 * 365.25);
            const months = Math.floor(absDiffMs / (1000 * 60 * 60 * 24 * (365.25 / 12)));
            absDiffMs -= months * (1000 * 60 * 60 * 24 * (365.25 / 12));
            const days = Math.floor(absDiffMs / (1000 * 60 * 60 * 24));
            absDiffMs -= days * (1000 * 60 * 60 * 24);
            const hours = Math.floor(absDiffMs / (1000 * 60 * 60));
            absDiffMs -= hours * (1000 * 60 * 60);
            const minutes = Math.floor(absDiffMs / (1000 * 60));
            absDiffMs -= minutes * (1000 * 60);
            const seconds = Math.floor(absDiffMs / 1000);
            ageTimer.textContent = `${String(years).padStart(2, '0')}Y ${String(months).padStart(2, '0')}M ${String(days).padStart(2, '0')}D ` +
                `${String(hours).padStart(2, '0')}H ${String(minutes).padStart(2, '0')}M ${String(seconds).padStart(2, '0')}S`;
        }

        startButton.addEventListener('click', () => {
            birthdayAudio.muted = true;
            birthdayAudio.play().then(() => {
                birthdayAudio.muted = false;
                birthdayAudio.currentTime = 0;
                birthdayAudio.play();
            }).catch(e => console.warn("Audio unlock failed", e));
            page1_start.classList.add('fade-out');
            page1_start.addEventListener('animationend', () => {
                page1_start.classList.add('hidden');
                page2_birthday.classList.remove('hidden');
                page2_birthday.classList.add('pop-in');
            }, { once: true }); 
        });

        birthdayContinueButton.addEventListener('click', () => {
            page2_birthday.classList.add('fade-out');
            page2_birthday.addEventListener('animationend', () => {
                page2_birthday.classList.add('hidden');
                page3_gallery.classList.remove('hidden');
                page3_gallery.classList.add('pop-in');
                updateAge(); setInterval(updateAge, 1000);
            }, { once: true }); 
        });

        galleryContinueButton.addEventListener('click', () => {
            page3_gallery.classList.add('fade-out');
            page3_gallery.addEventListener('animationend', () => {
                page3_gallery.classList.add('hidden');
                page4_animation.classList.remove('hidden');
                canvasPlaceholder.style.display = 'block';
                canvasPlaceholder.textContent = 'Loading gift...';
                loadImageFromSrc('./Sketch.jpg'); 
            }, { once: true }); 
        });

        function loadImageFromSrc(imageSrc) {
            originalImage = new Image();
            originalImage.crossOrigin = "Anonymous"; 
            originalImage.onload = () => {
                canvasPlaceholder.style.display = 'none';
                renderImage();
                const text = "Happiest Birthday!";
                birthdayTextOverlay.innerHTML = ""; 
                birthdayTextOverlay.classList.remove('hidden-overlay');
                for (let i = 0; i < text.length; i++) {
                    const char = text[i];
                    if (char === " ") {
                        const space = document.createElement('span');
                        space.className = "space-span"; space.innerHTML = "&nbsp;";
                        birthdayTextOverlay.appendChild(space);
                    } else {
                        const span = document.createElement('span');
                        span.textContent = char; span.className = "letter-span animate-letter";
                        span.style.animationDelay = `${i * 0.08}s`; 
                        birthdayTextOverlay.appendChild(span);
                    }
                }
            };
            originalImage.onerror = () => {
                canvasPlaceholder.style.display = 'block';
                canvasPlaceholder.textContent = 'Error loading image. Make sure Sketch.jpg is in the same folder.';
            };
            originalImage.src = imageSrc;
        }

        function renderImage() {
            if (!originalImage) return; 
            if (animationId) { cancelAnimationFrame(animationId); animationId = null; }
            const canvasSize = 1024;
            pixelCanvas.width = canvasSize; pixelCanvas.height = canvasSize;
            sourceCanvas.width = canvasSize; sourceCanvas.height = canvasSize;
            sourceCtx.drawImage(originalImage, 0, 0, originalImage.width, originalImage.height, 0, 0, canvasSize, canvasSize);
            
            // --- âœ… PIXEL SIZE IS 1 ---
            generatePixelData(1); 
            
            animate();
        }

        function generatePixelData(pixelSize) {
            flyingPixels = []; 
            const size = pixelSize; // Uses the value passed in (1)
            const w = sourceCanvas.width; const h = sourceCanvas.height; 
            const canvasW = pixelCanvas.width; const canvasH = pixelCanvas.height; 
            const imageData = sourceCtx.getImageData(0, 0, w, h).data;

            for (let y = 0; y < h; y += size) { 
                for (let x = 0; x < w; x += size) { 
                    const index = (y * w + x) * 4; 
                    const a = imageData[index + 3];
                    if (a > 20) { 
                        flyingPixels.push({
                            endX: x, endY: y, 
                            startX: Math.random() * canvasW, startY: Math.random() * canvasH, 
                            currentX: Math.random() * canvasW, currentY: Math.random() * canvasH, 
                            color: `rgba(${imageData[index]}, ${imageData[index + 1]}, ${imageData[index + 2]}, ${a / 255})`,
                            size: size 
                        });
                    }
                }
            }
        }

        function animate() {
            const w = pixelCanvas.width; const h = pixelCanvas.height;
            pixelCtx.clearRect(0, 0, w, h);
            let allPixelsInPlace = true; 
            for (const pixel of flyingPixels) {
                const dx = pixel.endX - pixel.currentX; const dy = pixel.endY - pixel.currentY;
                const dist = Math.sqrt(dx * dx + dy * dy);
                if (dist > 0.5) { 
                    allPixelsInPlace = false; 
                    pixel.currentX += dx * EASING_FACTOR; pixel.currentY += dy * EASING_FACTOR;
                } else { pixel.currentX = pixel.endX; pixel.currentY = pixel.endY; }
                pixelCtx.fillStyle = pixel.color; pixelCtx.fillRect(pixel.currentX, pixel.currentY, pixel.size, pixel.size); 
            }
            if (!allPixelsInPlace) { animationId = requestAnimationFrame(animate); } 
            else { animationId = null; console.log("Animation Complete!"); birthdayAudio.pause(); }
        }
    </script>
</body>
</html>


