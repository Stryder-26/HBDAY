<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Render Fx</title>
    <!-- 1. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. CSS Styling -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            color: #f3f4f6;
            overflow: hidden;
            margin: 0;
            padding: 0;
            position: relative; 
            height: 100vh;
            width: 100vw;
        }
        
        /* Page container helper */
        .page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #000;
        }

        #sourceCanvas { display: none; }
        
        #canvasWrapper {
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            top: 0;
            left: 0;
        }

        #pixelCanvas {
            width: 1024px;
            height: 1024px;
            max-width: 100vw;
            max-height: 100vh;
            background-color: #000;
            image-rendering: pixelated; 
            image-rendering: crisp-edges;
            z-index: 0; 
        }

        #canvasPlaceholder {
            position: absolute;
            z-index: 1; 
        }

        /* Animations */
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            60% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .pop-in {
            animation: popIn 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        .fade-out {
            animation: fadeOut 0.5s ease-out forwards;
        }

        /* --- Gallery Styles --- */
        #galleryScroller {
            display: flex;
            gap: 24px;
            padding: 24px;
            width: 100%;
            overflow-x: auto;
            white-space: nowrap;
            perspective: 1000px;
        }

        .gallery-card {
            flex-shrink: 0;
            width: 300px;
            height: 400px;
            background-color: #222;
            border-radius: 16px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
            overflow: hidden;
            transition: transform 0.4s ease, box-shadow 0.4s ease;
            transform: rotateY(15deg);
        }

        .gallery-card:hover {
            transform: rotateY(0deg) scale(1.05);
            box-shadow: 0 15px 30px rgba(0,0,0,0.6);
            z-index: 10;
        }

        .gallery-card img,
        .gallery-card video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Fallback text for images */
        .gallery-card img::before {
            content: "Image loading...";
            display: block;
            text-align: center;
            padding-top: 180px;
            color: #888;
        }
    </style>
</head>
<body>

    <!-- Page 1 - Start Button -->
    <div id="page1_start" class="page z-50 pop-in">
        <button id="startButton" 
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-8 rounded-full shadow-lg transform hover:scale-105 transition-transform duration-200 text-2xl">
            Start
        </button>
    </div>
    
    <!-- Page 2 - Birthday Wish (Hidden by default) -->
    <div id="page2_birthday" class="page z-40 hidden">
        <h1 class="text-6xl font-bold text-white mb-8 text-center animate-pulse">
            Happy Birthday!
        </h1>
        <button id="birthdayContinueButton" 
                class="bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-4 px-8 rounded-full shadow-lg transform hover:scale-105 transition-transform duration-200 text-2xl">
            Continue
        </button>
    </div>

    <!-- NEW: Page 3 - Memory Gallery (Hidden by default) -->
    <div id="page3_gallery" class="page z-30 hidden">
        <h2 class="text-4xl font-bold text-white mb-4 text-center px-4">
            A Few Happy Memories...
        </h2>
        
        <!-- The "Rolling" Card Scroller -->
        <div id="galleryScroller">
            <!-- Card 1 -->
            <div class="gallery-card">
                <img src="./IMG-20250915-WA0056.jpg" alt="Memory 1" onerror="this.src='https://placehold.co/300x400/222/FFF?text=IMG-20250915-WA0056.jpg'">
            </div>
            
            <!-- Card 2 (Video) -->
            <div class="gallery-card">
                <video src="./VID-20250915-WA0030.mp4" controls preload="metadata"></video>
            </div>
            
            <!-- Card 3 -->
            <div class="gallery-card">
                <img src="./IMG-20250915-WA0067.jpg" alt="Memory 2" onerror="this.src='https://placehold.co/300x400/222/FFF?text=IMG-20250915-WA0067.jpg'">
            </div>
            
            <!-- Card 4 -->
            <div class="gallery-card">
                <img src="./IMG-20250915-WA0068~2.jpg" alt="Memory 3" onerror="this.src='https://placehold.co/300x400/222/FFF?text=IMG-20250915-WA0068~2.jpg'">
            </div>
            
            <!-- Card 5 -->
            <div class="gallery-card">
                <img src="./IMG-20250919-WA0238.jpg" alt="Memory 4" onerror="this.src='https://placehold.co/300x400/222/FFF?text=IMG-20250919-WA0238.jpg'">
            </div>
            
            <!-- Card 6 -->
            <div class="gallery-card">
                <img src="./Snapchat-2031502399.jpg" alt="Memory 5" onerror="this.src='https://placehold.co/300x400/222/FFF?text=Snapchat-2031502399.jpg'">
            </div>
            
            <!-- Card 7 -->
            <div class="gallery-card">
                <img src="./IMG_20250727_212036_193.webp" alt="Memory 6" onerror="this.src='https://placehold.co/300x400/222/FFF?text=IMG_20250727_212036_193.webp'">
            </div>

            <!-- Card 8 -->
            <div class="gallery-card">
                <img src="./IMG_20250822_144858361~2.jpg" alt="Memory 7" onerror="this.src='https://placehold.co/300x400/222/FFF?text=IMG_20250822_144858361~2.jpg'">
            </div>

            <!-- Card 9 -->
            <div class="gallery-card">
                <img src="./IMG_20250919_135356382_HDR_PORTRAIT (1).jpg" alt="Memory 8" onerror="this.src='https://placehold.co/300x400/222/FFF?text=IMG_20250919...jpg'">
            </div>

            <!-- Card 10 -->
            <div class="gallery-card">
                <img src="./Screenshot_20250831-180221.Moto App Launcher.jpg" alt="Memory 9" onerror="this.src='https://placehold.co/300x400/222/FFF?text=Screenshot_20250831...jpg'">
            </div>

            <!-- Card 11 -->
            <div class="gallery-card">
                <img src="./Screenshot_20251110-225727.Moto App Launcher.png" alt="Memory 10" onerror="this.src='https://placehold.co/300x400/222/FFF?text=Screenshot_20251110...png'">
            </div>

            <!-- Card 12 -->
            <div class="gallery-card">
                <img src="./Screenshot_20251110-225746.Moto App Launcher.png" alt="Memory 11" onerror="this.src='https://placehold.co/300x400/222/FFF?text=Screenshot_20251110...png'">
            </div>

            <!-- Card 13 -->
            <div class="gallery-card">
                <img src="./Screenshot_20251110-225806.Moto App Launcher.png" alt="Memory 12" onerror="this.src='https://placehold.co/300x400/222/FFF?text=Screenshot_20251110...png'">
            </div>

            <!-- Card 14 -->
            <div class="gallery-card">
                <img src="./Screenshot_20251110-225825.Moto App Launcher.png" alt="Memory 13" onerror="this.src='https://placehold.co/300x400/222/FFF?text=Screenshot_20251110...png'">
            </div>
            
        </div>
        
        <button id="galleryContinueButton" 
                class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-full shadow-lg transform hover:scale-105 transition-transform duration-200 text-2xl mt-8">
            View Your Gift
        </button>
    </div>

    <!-- Page 4 - The Animation App (Hidden by default) -->
    <div id="page4_animation" class="hidden">
        <div id="canvasWrapper">
            <p id="canvasPlaceholder" class="text-gray-500 text-xl">Loading...</p>
            <canvas id="pixelCanvas"></canvas>
        </div>
        <canvas id="sourceCanvas"></canvas>
        <audio id="birthdayAudio" src="./music.mp3" preload="auto" loop></audio>
    </div>


    <!-- 5. JavaScript Logic -->
    <script>
        // --- Get DOM Elements ---
        const page1_start = document.getElementById('page1_start');
        const page2_birthday = document.getElementById('page2_birthday');
        const page3_gallery = document.getElementById('page3_gallery'); // New Page 3
        const page4_animation = document.getElementById('page4_animation'); // Old Page 3 is now 4

        const startButton = document.getElementById('startButton');
        const birthdayContinueButton = document.getElementById('birthdayContinueButton');
        const galleryContinueButton = document.getElementById('galleryContinueButton'); // New Button

        const sourceCanvas = document.getElementById('sourceCanvas');
        const sourceCtx = sourceCanvas.getContext('2d');
        const pixelCanvas = document.getElementById('pixelCanvas');
        const pixelCtx = pixelCanvas.getContext('2d');
        const canvasPlaceholder = document.getElementById('canvasPlaceholder');
        const birthdayAudio = document.getElementById('birthdayAudio');

        let originalImage = null;
        let flyingPixels = [];
        let animationId = null;
        const EASING_FACTOR = 0.25; 

        // --- Page 1 Button Click (Starts Music) ---
        startButton.addEventListener('click', () => {
            birthdayAudio.muted = true;
            birthdayAudio.play().then(() => {
                birthdayAudio.muted = false;
                birthdayAudio.currentTime = 0;
                birthdayAudio.play();
                console.log("Audio context started, music playing.");
            }).catch(e => console.warn("Audio unlock failed", e));

            page1_start.classList.add('fade-out');
            page1_start.addEventListener('animationend', () => {
                page1_start.classList.add('hidden');
                page2_birthday.classList.remove('hidden');
                page2_birthday.classList.add('pop-in');
            }, { once: true }); 
        });

        // --- Page 2 Button Click (Fades to Gallery) ---
        birthdayContinueButton.addEventListener('click', () => {
            page2_birthday.classList.add('fade-out');
            page2_birthday.addEventListener('animationend', () => {
                page2_birthday.classList.add('hidden');
                // --- NEW: Show Page 3 (Gallery) ---
                page3_gallery.classList.remove('hidden');
                page3_gallery.classList.add('pop-in');
            }, { once: true }); 
        });

        // --- NEW: Page 3 Button Click (Fades to Animation) ---
        galleryContinueButton.addEventListener('click', () => {
            page3_gallery.classList.add('fade-out');
            page3_gallery.addEventListener('animationend', () => {
                page3_gallery.classList.add('hidden');
                // --- Show Page 4 (Animation) ---
                page4_animation.classList.remove('hidden');

                // Load default Sketch.jpg (with capital S)
                console.log("Loading default image: Sketch.jpg");
                canvasPlaceholder.style.display = 'block';
                canvasPlaceholder.textContent = 'Loading sketch...';
                
                loadImageFromSrc('./Sketch.jpg'); 

            }, { once: true }); 
        });

        /**
         * Loads an image from a source (file, base64, or URL) into the app.
         */
        function loadImageFromSrc(imageSrc) {
            originalImage = new Image();
            originalImage.crossOrigin = "Anonymous"; 

            originalImage.onload = () => {
                if (originalImage.width !== 1024 || originalImage.height !== 1024) {
                    console.warn(`Warning: Image is ${originalImage.width}x${originalImage.height}. It will be scaled to 1024x1024.`);
                }
                canvasPlaceholder.style.display = 'none';
                renderImage();
            };
            originalImage.onerror = () => {
                console.error(`Failed to load image source: ${imageSrc}`);
                canvasPlaceholder.style.display = 'block';
                canvasPlaceholder.textContent = 'Error loading image. Make sure Sketch.jpg is in the same folder.';
            };
            originalImage.src = imageSrc;
        }

      
        // --- Animation Logic (No changes here) ---
        
        function renderImage() {
            if (!originalImage) return; 

            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            const canvasSize = 1024;
            pixelCanvas.width = canvasSize;
            pixelCanvas.height = canvasSize;
            sourceCanvas.width = canvasSize;
            sourceCanvas.height = canvasSize;

            sourceCtx.drawImage(
                originalImage, 0, 0, 
                originalImage.width, originalImage.height, 
                0, 0, canvasSize, canvasSize 
            );

            generatePixelData(); 
            animate();
        }

        function generatePixelData() {
            flyingPixels = []; 
            const size = 1;
            const w = sourceCanvas.width; 
            const h = sourceCanvas.height; 
            const canvasW = pixelCanvas.width; 
            const canvasH = pixelCanvas.height; 
            const imageData = sourceCtx.getImageData(0, 0, w, h).data;

            for (let y = 0; y < h; y += size) { 
                for (let x = 0; x < w; x += size) { 
                    const index = (y * w + x) * 4; 
                    const r = imageData[index];
                    const g = imageData[index + 1];
                    const b = imageData[index + 2];
                    const a = imageData[index + 3];

                    if (a > 20) { 
                        flyingPixels.push({
                            endX: x, endY: y, 
                            startX: Math.random() * canvasW, 
                            startY: Math.random() * canvasH, 
                            currentX: Math.random() * canvasW, 
                            currentY: Math.random() * canvasH, 
                            color: `rgba(${r}, ${g}, ${b}, ${a / 255})`,
                            size: size 
                        });
                    }
                }
            }
        }

        function animate() {
            const w = pixelCanvas.width;
            const h = pixelCanvas.height;
            pixelCtx.clearRect(0, 0, w, h);
            
            let allPixelsInPlace = true; 

            for (const pixel of flyingPixels) {
                const dx = pixel.endX - pixel.currentX;
                const dy = pixel.endY - pixel.currentY;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist > 0.5) { 
                    allPixelsInPlace = false; 
                    pixel.currentX += dx * EASING_FACTOR;
                    pixel.currentY += dy * EASING_FACTOR;
                } else {
                    pixel.currentX = pixel.endX;
                    pixel.currentY = pixel.endY;
                }
                pixelCtx.fillStyle = pixel.color;
                pixelCtx.fillRect(pixel.currentX, pixel.currentY, pixel.size, pixel.size); 
            }

            if (!allPixelsInPlace) {
                animationId = requestAnimationFrame(animate);
            } else {
                animationId = null;
                console.log("Animation Complete!");
                birthdayAudio.pause();
            }
        }
    </script>
</body>
</html>


    
